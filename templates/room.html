{% extends 'base.html' %}
{% block content %}

<body>
    <div class="message-box">
        <h2>Chat Room: {{room}}</h2>
        <div class="messages" id="messages"></div>
        <div class="inputs">
            <input type="text" rows="3" placeholder="Message" name="message" id="message" />
            <button class="buttonRight" type="button" name="send" id="send-btn" onClick="sendMessage()">
                Send
            </button>
        </div>
    </div>

    <script>
        var socketio = io();

        const room = "{{room}}";
        const name = "{{name}}";
        const messages = document.getElementById("messages");

        const createMessage = (name, msg) => {
            const content = `
            <div class="text">
                <span>
                    <strong>${name}</strong>: ${msg}
                </span>
                <span class="muted">
                    ${new Date().toLocaleString()}
                </span>
            </div>
            `;

            messages.innerHTML += content;
        };

        // Join the room
        socketio.emit('join', { name: name, room: room });

        // Listen for incoming messages
        socketio.on('message', (data) => {
            createMessage(data.name, data.message);
        });

        const sendMessage = () => {
            const message = document.getElementById("message").value;
            if (message == "") return;
            socketio.emit('send_message', { name: name, room: room, message: message });
            document.getElementById("message").value = "";
        };

        // Enter key to send message
        var input = document.getElementById("message");
        input.addEventListener("keypress", function (event) {
            if (event.key === "Enter") {
                event.preventDefault();
                document.getElementById("send-btn").click();
            }
        });
    </script>
</body>
{% endblock %}